<html>
  <head>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
  </head>
    <body>

        <a href="#" onclick="login()"> LOGIN </a>
        <a href="http://localhost:3000/api/logout"> LOGOUT </a>
        <a href="#" id="proj" onclick="alertProj()"> PROJECTS </a>


        <script type="text/javascript">
         var token = undefined;
         var login = function() {
             var popup = window.open("http://localhost:3000/api/login");
             iid = setInterval(function() {
                 popup.postMessage("ping","http://localhost:3000"); // api url
             },500);
             var receiveMessage = function(e) {
                 alert(e.data);
                 token = e.data;
                 clearInterval(iid);
             }
             window.addEventListener("message", receiveMessage, false);
         }

         // cors
         $.ajaxSetup({
             xhrFields: {
                 withCredentials: true
             },
             crossDomain: true
         });

         var alertProj = function() {
             if(!token) { alert('not authed'); return; }
             $.ajax({
                 url: 'http://localhost:3000/api/projects',
                 type: 'GET',
                 beforeSend: function (xhr) {
                     xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                 }
             })
              .then(res => {
                 alert('got data: ' + res);
             }).fail((xhr, text, code) => {
                 alert('req failed: ' + code);
             })
         }
        </script>
    </body>
</html>
